# -------------------------------
# MapProxy example configuration.
# -------------------------------
#
# This is a minimal MapProxy configuration.
# See full_example.yaml and the documentation for more options.
#

# Starts the following services:
# Demo:
#     http://localhost:8080/demo
# WMS:
#     capabilities: http://localhost:8080/service?REQUEST=GetCapabilities
# WMTS:
#     capabilities: http://localhost:8080/wmts/1.0.0/WMTSCapabilities.xml
#     first tile: http://localhost:8080/wmts/osm/webmercator/0/0/0.png
# Tile service (compatible with OSM/etc.)
#     first tile: http://localhost:8080/tiles/osm/webmercator/0/0/0.png
# TMS:
#     note: TMS is not compatible with OSM/Google Maps/etc.
#     first tile: http://localhost:8080/tms/1.0.0/osm/webmercator/0/0/0.png
# KML:
#     initial doc: http://localhost:8080/kml/osm/webmercator

services:
  demo:
  tms:
    use_grid_names: true
    # origin for /tiles service
    origin: 'nw'
  kml:
    use_grid_names: true
  wmts:
  wms:
    md:
      title: MapProxy WMS Proxy
      abstract: This is a minimal MapProxy example.

layers:
  - name: tianditu_cia
    title: 天地图影像注记
    sources: [tianditu_cia_cache]
    md:
      abstract: 天地图影像注记
  - name: tianditu_img
    title: 天地图影像地图
    sources: [tianditu_img_cache]
    md:
      abstract: 天地图影像地图

caches:
  tianditu_cia_cache:
    grids: [webmercator]
    sources: [tianditu_cia]
    cache:
      type: geopackage
      filename: tianditu_cia.gpkg
  tianditu_img_cache:
    grids: [webmercator]
    sources: [tianditu_img]
    cache:
      type: geopackage
      filename: tianditu_img.gpkg

sources:
  # 天地图影像注记
  tianditu_cia:
    type: tile
    url: https://t4.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TileCol=%(x)s&TileRow=%(y)s&TileMatrix=%(z)s&tk=cfcbc282308686d26782fcb4e11b32a4
    grid: GLOBAL_WEBMERCATOR
    transparent: true
    http:
      headers:
        Referer: 'https://www.tianditu.gov.cn/'
        User-Agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.167 Safari/537.36'
  # 天地图影像地图
  tianditu_img:
    type: tile
    url: https://t4.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TileCol=%(x)s&TileRow=%(y)s&TileMatrix=%(z)s&tk=cfcbc282308686d26782fcb4e11b32a4
    grid: GLOBAL_WEBMERCATOR
    transparent: false
    http:
      headers:
        Referer: 'https://www.tianditu.gov.cn/'
        User-Agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.167 Safari/537.36'
grids:
  webmercator:
    base: GLOBAL_WEBMERCATOR

globals:
